// ========================= ENUMS =========================

enum EscalaMensualEstado {
  CONSTRUCCION
  VIGENTE
  REVISION
  LISTA_PAGO
  PROCESADA
}

// ========================= CENTROS DE SALUD =========================
model ASC_centro_salud {
  centro_salud_id Int @id @default(autoincrement())

  nombre    String  @db.VarChar(150)
  ubicacion String  @db.VarChar(255)
  contacto  String? @db.VarChar(150)
  telefono  String? @db.VarChar(50)
  email     String? @db.VarChar(150)

  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  puesto_medico  ASC_puesto_medico[]
  procedimiento  ASC_procedimiento[]
  escala_mensual ASC_escala_mensual[]
}

model ASC_puesto_medico {
  puesto_medico_id Int @id @default(autoincrement())

  centro_salud    ASC_centro_salud @relation(fields: [centro_salud_id], references: [centro_salud_id])
  centro_salud_id Int

  especialidad String   @db.VarChar(150)
  descripcion  String?  @db.VarChar(4000)
  costo_turno  Decimal  @default(0.0)
  pago_turno   Decimal  @default(0.0)
  pago_hora    Decimal?

  created_at DateTime @default(now())

  turno          ASC_turno[]
  escala_semanal ASC_escala_semanal[]
}

model ASC_turno {
  turno_id Int @id @default(autoincrement())

  puesto_medico    ASC_puesto_medico @relation(fields: [puesto_medico_id], references: [puesto_medico_id])
  puesto_medico_id Int

  nombre          String @db.VarChar(50)
  hora_inicio_min Int
  hora_fin_min    Int

  created_at DateTime @default(now())

  escala_semanal ASC_escala_semanal[]
}

model ASC_procedimiento {
  procedimiento_id Int @id @default(autoincrement())

  centro_salud    ASC_centro_salud @relation(fields: [centro_salud_id], references: [centro_salud_id])
  centro_salud_id Int

  nombre       String  @db.VarChar(150)
  descripcion  String? @db.VarChar(4000)
  costo_centro Decimal @default(0.0)
  pago_medico  Decimal @default(0.0)

  created_at DateTime @default(now())

  procedimiento_detalle ASC_procedimiento_detalle[]
}

model ASC_procedimiento_detalle {
  procedimiento_detalle_id Int @id @default(autoincrement())

  procedimiento    ASC_procedimiento @relation(fields: [procedimiento_id], references: [procedimiento_id])
  procedimiento_id Int
  medico           ASC_Medico        @relation(fields: [medico_id], references: [medico_id])

  fecha         DateTime
  observaciones String?  @db.VarChar(4000)

  created_at DateTime @default(now())
  medico_id  Int
}

model ASC_escala_semanal {
  escala_semanal_id Int @id @default(autoincrement())

  puesto_medico    ASC_puesto_medico @relation(fields: [puesto_medico_id], references: [puesto_medico_id])
  puesto_medico_id Int
  turno            ASC_turno         @relation(fields: [turno_id], references: [turno_id])
  turno_id         Int

  semana Int
  anio   Int

  created_at DateTime @default(now())

  escala_mensual_detalle ASC_escala_mensual_detalle[]

  @@unique([puesto_medico_id, turno_id, semana, anio])
}

model ASC_escala_mensual {
  escala_mensual_id Int @id @default(autoincrement())

  centro_salud    ASC_centro_salud @relation(fields: [centro_salud_id], references: [centro_salud_id])
  centro_salud_id Int

  mes    Int
  anio   Int
  estado EscalaMensualEstado @default(CONSTRUCCION) // antes era String

  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  escala_mensual_detalle ASC_escala_mensual_detalle[]

  @@unique([centro_salud_id, mes, anio])
}

model ASC_escala_mensual_detalle {
  escala_mensual_detalle_id Int @id @default(autoincrement())

  escala_mensual    ASC_escala_mensual  @relation(fields: [escala_mensual_id], references: [escala_mensual_id])
  escala_mensual_id Int
  escala_semanal    ASC_escala_semanal? @relation(fields: [escala_semanal_id], references: [escala_semanal_id])
  escala_semanal_id Int?
  medico            ASC_Medico?         @relation(fields: [medico_id], references: [medico_id])

  fecha              DateTime
  trabajada          String    @default("N") @db.Char(1)
  hora_real_inicio   DateTime?
  hora_real_fin      DateTime?
  observacion_cambio String?   @db.VarChar(4000)

  created_at DateTime @default(now())
  medico_id  Int?

  @@unique([escala_mensual_id, fecha, escala_semanal_id, medico_id])
}
