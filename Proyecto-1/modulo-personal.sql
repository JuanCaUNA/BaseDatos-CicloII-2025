-- * MODULO DE PERSONAL *
-- * ------------------


-- ! NOTAS: ESTANDARES;
-- ACS NOMBRE DE LA EMPRESA
-- NOMBRES DE TABLAS: ACS_<NOMBRE>
--                    LIMITE DE LARGO: 30 CARACTERES
-- NOMBRES DE COLUMNAS:
--                      LIMITE DE LARGO: 30 CARACTERES

-- ! TABLA
CREATE TABLE  ACS_PERMISO (
   PERMISO_ID  NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,

   PANTALLA    VARCHAR2(255) UNIQUE,

   LECTURA     NUMBER(1) DEFAULT 0,
   CREACIÓN    NUMBER(1) DEFAULT 0,
   ESCRITURA   NUMBER(1) DEFAULT 0,
   ELIMINACION NUMBER(1) DEFAULT 0,

   TIPO_USUARIO VARCHAR2(20) CHECK ( TIPO_USUARIO IN ( 'MEDICO', 'ADMINISTRATIVO' ) ) UNIQUE
);

-- * COMENTARIOS DESCRIPTIVOS
COMMENT ON TABLE ACS_PERMISO IS 'PERMISOS DE ACCESO POR TIPO DE USUARIO';

-- ! TABLA
CREATE TABLE  ACS_PRERREGISTRO (
   PRERREGISTRO_ID   NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,

   CEDULA            VARCHAR2(20) UNIQUE,
   NOMBRE            VARCHAR2(100),
   APELLIDOS         VARCHAR2(100),
   FECHA_NACIMIENTO  DATE,

   SEXO              VARCHAR2(10), CHECK ( SEXO IN ( 'MACULINO', 'FEMENINO', 'OTRO' ) ),
   ESTADO_CIVIL      VARCHAR2(20), CHECK ( ESTADO_CIVIL IN ( 'SOLTERO', 'CASADO', 'DIVORCIADO', 'VIUDO' ) ),
   TIPO_NACIONALIDAD VARCHAR2(20) CHECK ( TIPO_NACIONALIDAD IN ( 'NACIONAL', 'EXTRANJERO' ) ),

   RESIDENCIA        VARCHAR2(255),
   EMAIL             VARCHAR2(255) UNIQUE,
   TELEFONO          VARCHAR2(20),
   DIRECCION_CASA    VARCHAR2(255),
   DIRECCION_TRABAJO VARCHAR2(255),

   ESTADO_REGISTRO   VARCHAR2(20) DEFAULT 'PENDIENTE' CHECK ( ESTADO_REGISTRO IN ( 'PENDIENTE', 'APROBADO', 'RECHAZADO' ) ),

   -- AUDITORIA
   FECHA_CREACION   DATE DEFAULT SYSDATE
);

-- * COMENTARIOS DESCRIPTIVOS
COMMENT ON TABLE ACS_PRERREGISTRO IS 'DATOS DE SOLICITANTES A SER USUARIOS';
COMMENT ON COLUMN ACS_PRERREGISTRO.RESIDENCIA IS 'LUGAR GENERAL DONDE VIVE';
COMMENT ON COLUMN ACS_PRERREGISTRO.DIRECCION_CASA IS 'DIRECCIÓN ESPECÍFICA DE LA CASA';
COMMENT ON COLUMN ACS_PRERREGISTRO.DIRECCION_TRABAJO IS 'DIRECCIÓN ESPECÍFICA DEL TRABAJO';
COMMENT ON COLUMN ACS_PRERREGISTRO.ESTADO_REGISTRO IS 'AL CAMBIAR DE ESTADO, SE DEBE CREAR EL USUARIO O RECHAZAR LA SOLICITUD. LUEGO SE BORRA EL REGISTRO';

-- ! TABLA
CREATE TABLE  ACS_USUARIO (
   USUARIO_ID        NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,

   -- DATOS DE PERSONA
   CEDULA            VARCHAR2(20) UNIQUE,
   NOMBRE            VARCHAR2(100),
   APELLIDOS         VARCHAR2(100),
   FECHA_NACIMIENTO  DATE,

   -- TIPOS
   SEXO              VARCHAR2(10), CHECK ( SEXO IN ( 'MACULINO', 'FEMENINO', 'OTRO' ) ),
   ESTADO_CIVIL      VARCHAR2(20), CHECK ( TIPO_NACIONALIDAD IN ( 'SOLTERO', 'CASADO', 'DIVORCIADO', 'VIUDO' ) ),
   TIPO_NACIONALIDAD VARCHAR2(20) CHECK ( TIPO_NACIONALIDAD IN ( 'NACIONAL', 'EXTRANJERO' ) ),
   TIPO_USUARIO      VARCHAR2(20) CHECK ( TIPO_USUARIO IN ( 'MEDICO', 'ADMINISTRATIVO' ) ),

   -- COCTACTO
   EMAIL             VARCHAR2(255) UNIQUE,
   TELEFONO          VARCHAR2(20),
   RESIDENCIA        VARCHAR2(255),
   DIRECCION_CASA    VARCHAR2(255),
   DIRECCION_TRABAJO VARCHAR2(255),

   -- AUDITORIA
   FECHA_CREACION   DATE DEFAULT SYSDATE,
   FECHA_MODIFICACION DATE
);

-- * ÍNDICES
CREATE INDEX IDX_ ON ACS_USUARIO (CEDULA);
CREATE INDEX IDX_NOMBRE_COMPLETO ON ACS_USUARIO (NOMBRE, APELLIDOS);
CREATE INDEX INX_TIPO_USUARIO ON ACS_USUARIO (TIPO_USUARIO);

-- * COMENTARIOS DESCRIPTIVOS
COMMENT ON TABLE ACS_USUARIO IS 'DATOS DE USUARIO';
COMMENT ON COLUMN ACS_USUARIO.RESIDENCIA IS 'LUGAR GENERAL DONDE VIVE';
COMMENT ON COLUMN ACS_USUARIO.DIRECCION_CASA IS 'DIRECCIÓN ESPECÍFICA DE LA CASA';
COMMENT ON COLUMN ACS_USUARIO.DIRECCION_TRABAJO IS 'DIRECCIÓN ESPECÍFICA DEL TRABAJO';
COMMENT ON COLUMN ACS_USUARIO.TIPO_USUARIO IS 'DEFINE EL PERFIL DEL USUARIO, SE DEBE CREAR EL PERFIL CORRESPONDIENTE CON EL MISNMO ID DE USUARIO';

-- ! TABLA
CREATE TABLE  ACS_BANCO (
   BANCO_ID   NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,

   NOMBRE     VARCHAR2(100) UNIQUE,

   DIRECCION  VARCHAR2(255),
   TELEFONO   VARCHAR2(20)
);

-- ! TABLA
CREATE TABLE  ACS_CUENTA_BANCARIA (
   CUENTABANCARIA_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,

   NUMERO            VARCHAR2(50) UNIQUE,
   TITULAR           VARCHAR2(200),
   TIPO_CUENTA       VARCHAR2(20) CHECK ( TIPO_CUENTA IN ( 'AHORROS', 'CORRIENTE' ) ),
   ES_PRINCIPAL      NUMBER(1),

   -- RELATION
   BANCO_ID         NUMBER,
   USUARIO_ID        NUMBER,

   CONSTRAINT FK_CUENTA_BANCARIA_BANCO FOREIGN KEY ( BANCO_ID )
      REFERENCES ACS_BANCO ( BANCO_ID ),

   CONSTRAINT FK_CUENTA_BANCARIA_USUARIO FOREIGN KEY ( USUARIO_ID )
      REFERENCES ACS_USUARIO ( USUARIO_ID )
);

-- ! TABLA
CREATE TABLE  ACS_MEDICO (
   MEDICO_ID  PRIMARY KEY,

   ESTADO     VARCHAR2(20) DEFAULT 'ACTIVO' CHECK ( ESTADO IN ( 'ACTIVO', 'INACTIVO' ) ),

   -- RELATION
   USUARIO_ID NUMBER UNIQUE,

   CONSTRAINT FK_MEDICO_USUARIO FOREIGN KEY ( USUARIO_ID )
      REFERENCES ACS_USUARIO ( USUARIO_ID )
);

-- * COMENTARIOS DESCRIPTIVOS
COMMENT ON COLUMN ACS_MEDICO.MEDICO_ID IS 'EL ID DEL MÉDICO ES EL MISMO QUE EL ID DEL USUARIO ASOCIADO';

-- ! TABLA
CREATE TABLE  ACS_ADMINISTRATIVO (
   ADMINISTRATIVO_ID PRIMARY KEY,

   ESTADO            VARCHAR2(20) DEFAULT 'ACTIVO' CHECK ( ESTADO IN ( 'ACTIVO', 'INACTIVO' ) ),

   -- RELATION
   USUARIO_ID        NUMBER UNIQUE,

   CONSTRAINT FK_ADMINISTRATIVO_USUARIO FOREIGN KEY ( USUARIO_ID )
      REFERENCES ACS_USUARIO ( USUARIO_ID )
);

-- * COMENTARIOS DESCRIPTIVOS
COMMENT ON COLUMN ACS_ADMINISTRATIVO.ADMINISTRATIVO_ID IS 'EL ID DEL ADMINISTRATIVO ES EL MISMO QUE EL ID DEL USUARIO ASOCIADO';

-- ! TABLA
CREATE TABLE  ACS_DETALLE_DOCUMENTO (
   DETALLE_DOCUMENTO_ID  NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,

   TIPO_USUARIO          VARCHAR2(20) CHECK ( TIPO_USUARIO IN ( 'MEDICO', 'ADMINISTRATIVO' ) ) UNIQUE,
   DOCUMENTOS_REQUERIDOS VARCHAR2(4000)
);

-- * COMENTARIOS DESCRIPTIVOS
COMMENT ON TABLE ACS_DETALLE_DOCUMENTO IS 'DOCUMENTOS REQUERIDOS POR TIPO DE USUARIO, SEPARADOS POR COMAS';

-- ! TABLA
CREATE TABLE  ACS_DOCUMENTO (
   DOCUMENTO_ID      NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,

   URL               VARCHAR2(1000) UNIQUE,
   DESCRIPCION       VARCHAR2(4000),

   -- RELATION
   USUARIO_ID        NUMBER UNIQUE
);

-- * COMENTARIOS DESCRIPTIVOS
COMMENT ON TABLE ACS_DOCUMENTO IS 'DOCUMENTOS SUBIDOS POR LOS USUARIOS, RELACIONADOS CON SU';


-- * TRIGGERS


-- * END MODULO DE PERSONAL *
-- * ------------------