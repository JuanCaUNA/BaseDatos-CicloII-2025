
SET SERVEROUTPUT ON;
PROMPT ============================================================
PROMPT  üîπ INICIO DE PRUEBAS - M√ìDULO CENTROS DE SALUD
PROMPT ============================================================

-- 1Ô∏è‚É£ LIMPIEZA DE DATOS PREVIOS
PROMPT ‚Üí Limpiando tablas previas...
DELETE FROM ACS_DETALLE_MENSUAL;
DELETE FROM ACS_ESCALA_MENSUAL;
DELETE FROM ACS_TURNO;
DELETE FROM ACS_MEDICO;
DELETE FROM ACS_USUARIO;
DELETE FROM ACS_PERSONA;
DELETE FROM ACS_PUESTO_MEDICO;
DELETE FROM ACS_CENTRO_MEDICO;
COMMIT;

PROMPT Tablas limpiadas correctamente.

-- 2Ô∏è‚É£ CREACI√ìN DE DATOS BASE
PROMPT ‚Üí Insertando datos base...

INSERT INTO ACS_CENTRO_MEDICO (ACM_NOMBRE, ACM_UBICACION, ACM_TELEFONO, ACM_EMAIL, ACM_ESTADO)
VALUES ('Centro Prueba', 'San Jos√©', '2222-2222', 'centro@prueba.com', 'ACTIVO');

INSERT INTO ACS_PUESTO_MEDICO (APM_NOMBRE, APM_DESCRIPCION, APM_ESTADO)
VALUES ('Pediatr√≠a', 'Atenci√≥n infantil', 'ACTIVO');

INSERT INTO ACS_PERSONA (APE_CEDULA, APE_NOMBRE, APE_P_APELLIDO, APE_FECHA_NACIMIENTO, 
                         APE_TIPO_USUARIO, APE_ESTADO_REGISTRO, APE_EMAIL, APE_FECHA_ACTUALIZACION)
VALUES ('888888888', 'Carlos', 'Mora', SYSDATE, 'MEDICO', 'APROBADO', 'carlos@una.cr', SYSDATE);

INSERT INTO ACS_USUARIO (APE_ID, AUS_ESTADO, AUS_FECHA_CREACION, AUS_ULTIMO_ACCESO)
VALUES ((SELECT MAX(APE_ID) FROM ACS_PERSONA), 'ACTIVO', SYSDATE, SYSDATE);

INSERT INTO ACS_MEDICO (AUS_ID, AME_ESTADO)
VALUES ((SELECT MAX(AUS_ID) FROM ACS_USUARIO), 'ACTIVO');

INSERT INTO ACS_TURNO (ATU_NOMBRE, ATU_HORA_INICIO, ATU_HORA_FIN, ATU_TIPO_PAGO, 
                       ATU_COSTO, ATU_PAGO, ATU_ESTADO)
VALUES ('Ma√±ana', TIMESTAMP '2025-11-01 07:00:00', TIMESTAMP '2025-11-01 13:00:00', 
        'HORAS', 5000, 8000, 'ACTIVO');

COMMIT;

PROMPT Datos base insertados correctamente.

-- 3Ô∏è‚É£ VERIFICACI√ìN DE DATOS BASE
PROMPT ‚Üí Verificando IDs base:
SELECT ACM_ID, ACM_NOMBRE FROM ACS_CENTRO_MEDICO;
SELECT AME_ID FROM ACS_MEDICO;
SELECT APM_ID FROM ACS_PUESTO_MEDICO;
SELECT ATU_ID FROM ACS_TURNO;

-- 4Ô∏è‚É£ GENERACI√ìN DE ESCALA MENSUAL
PROMPT ‚Üí Ejecutando procedimiento PRC_GENERAR_ESCALA_MENSUAL...
DECLARE
  v_centro NUMBER;
BEGIN
  SELECT MIN(ACM_ID) INTO v_centro FROM ACS_CENTRO_MEDICO;
  PRC_GENERAR_ESCALA_MENSUAL(v_centro, 11, 2025);
END;
/

-- 5Ô∏è‚É£ CONSULTA DE ESCALAS
PROMPT ‚Üí Consultando la escala mensual generada...
DECLARE
  v_centro NUMBER;
BEGIN
  SELECT MIN(ACM_ID) INTO v_centro FROM ACS_CENTRO_MEDICO;
  PRC_Consultar_Escalas(v_centro, 11, 2025);
END;
/

-- 6Ô∏è‚É£ REASIGNACI√ìN DE M√âDICO EN UN TURNO
PROMPT ‚Üí Reasignando m√©dico al primer turno del mes...
DECLARE
  v_adm_id NUMBER;
  v_med_id NUMBER;
BEGIN
  SELECT MIN(ADM_ID) INTO v_adm_id FROM ACS_DETALLE_MENSUAL;
  SELECT MIN(AME_ID) INTO v_med_id FROM ACS_MEDICO;
  PRC_Asignar_Medico_Turno(v_adm_id, v_med_id);
END;
/

-- 7Ô∏è‚É£ CONSULTA POST-REASIGNACI√ìN
PROMPT ‚Üí Consultando escala tras la reasignaci√≥n...
DECLARE
  v_centro NUMBER;
BEGIN
  SELECT MIN(ACM_ID) INTO v_centro FROM ACS_CENTRO_MEDICO;
  PRC_Consultar_Escalas(v_centro, 11, 2025);
END;
/

-- 8Ô∏è‚É£ VALIDACI√ìN FINAL
PROMPT ‚Üí Mostrando 10 registros de detalle:
SELECT ADM_ID, ADM_FECHA, AME_ID, APM_ID, ATU_ID, ADM_ESTADO_TURNO
FROM ACS_DETALLE_MENSUAL
WHERE ROWNUM <= 10;

PROMPT ============================================================
PROMPT  ‚úÖ PRUEBAS COMPLETADAS CORRECTAMENTE
PROMPT ============================================================

COMMIT;
